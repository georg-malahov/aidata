// Generated by CoffeeScript 1.8.0
angular.module('app').directive("tablecontrolPreview", [
  '$rootScope', '$timeout', function($rootScope, $timeout) {
    return {
      restrict: "CA",
      link: function(scope, elm, attrs) {
        var onClick;
        console.info("tablecontrolPreview inited");
        elm.popover({
          html: true,
          container: 'body',
          content: function() {
            var pixel_code, pixel_id;
            pixel_id = "";
            $rootScope.editedPixel && (pixel_id = $rootScope.editedPixel.pixel_id);
            pixel_code = "<img src='http://advombat.ru/0.gif?pid=" + pixel_id + "' width='0px' height='0px'/>";
            return "<textarea class=\"form-control\" readonly onclick=\"this.focus();this.select()\">" + pixel_code + "</textarea>";
          },
          placement: 'right',
          trigger: 'click'
        });
        onClick = function(e) {
          if (!jQuery(e.target).parents(".popover").length) {
            return elm.popover("hide");
          }
        };
        elm.on("shown.bs.popover", function() {
          return jQuery("body").bind("click", onClick);
        });
        return elm.on("hidden.bs.popover", function() {
          return jQuery("body").unbind("click");
        });
      }
    };
  }
]);
